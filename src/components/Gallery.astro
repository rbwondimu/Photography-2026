---
interface Props {
    category?: string;
}

const { category = "All" } = Astro.props;
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';

// Load all images from the portfolio directory (recursively)
const allImages = import.meta.glob<{ default: ImageMetadata }>('/src/assets/portfolio/**/*.{jpeg,jpg,png,gif,JPEG,JPG,PNG,GIF}');

let images = Object.keys(allImages);

// Map to useful objects
const loadedImages = await Promise.all(
    images.map(async (path) => {
        const image = await allImages[path]();
        // Extract filename as title
        const name = path.split('/').pop()?.split('.')[0] || 'Untitled';
        return {
            src: image.default,
            title: name.replace(/-/g, ' '),
            category: 'Portfolio'
        };
    })
);

// Fallback to placeholders if no images found
const usePlaceholders = loadedImages.length === 0;
const placeholderImages = Array.from({ length: 9 }).map((_, i) => ({
    id: i,
    title: `Portfolio Shot ${i + 1}`,
    color: `hsl(${Math.random() * 360}, 50%, 40%)`
}));
---

<div class="gallery-grid">
    {!usePlaceholders && loadedImages.map((img) => (
        <div class="gallery-item">
            <Image src={img.src} alt={img.title} width={600} height={800} class="image-real" />
            <div class="overlay">
                <h3>{img.title}</h3>
            </div>
        </div>
    ))}

    {usePlaceholders && placeholderImages.map((img) => (
        <div class="gallery-item">
            <div class="image-placeholder" style={`background-color: ${img.color};`}></div>
            <div class="overlay">
                <h3>{img.title}</h3>
                <p style="font-size: 0.8rem; opacity: 0.8;">(Placeholder)</p>
            </div>
        </div>
    ))}
</div>

<style>
    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: var(--spacing-md);
        padding: var(--spacing-md) 0;
    }
    
    .gallery-item {
        position: relative;
        overflow: hidden;
        aspect-ratio: 3/4;
        cursor: pointer;
    }

    .image-placeholder, .image-real {
        width: 100%;
        height: 100%;
        transition: transform 0.5s ease;
        object-fit: cover;
    }

    .gallery-item:hover .image-placeholder {
        transform: scale(1.05);
    }

    .overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: var(--spacing-md);
        background: linear-gradient(transparent, rgba(0,0,0,0.8));
        color: white;
        opacity: 0;
        transition: opacity 0.3s ease;
        display: flex;
        align-items: flex-end;
    }

    .gallery-item:hover .overlay {
        opacity: 1;
    }

    .overlay h3 {
        margin: 0;
        font-family: var(--font-sans);
        font-size: 1rem;
        font-weight: 300;
        letter-spacing: 0.1em;
        text-transform: uppercase;
    }
</style>
